require "./spec"

describe "SECTION: Literals (0x0_)" do
  opcode "0x00 null", [nil],                     0x00
  opcode "0x01 byte", [0_u8],                    0x01, 0x00
  opcode "0x02 bool", [false],                   0x02, 0x00
  opcode "0x03 i32 ", [252645135_i32],           0x03, 0x0f, 0x0f, 0x0f, 0x0f
  opcode "0x04 i64 ", [1085102592571150095_i64], 0x04, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f
  opcode "0x05 u32 ", [252645135_u32],           0x05, 0x0f, 0x0f, 0x0f, 0x0f
  opcode "0x06 u64 ", [1085102592571150095_u64], 0x06, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f
  opcode "0x07 f32 ", [9000.1_f32],              0x07, 0x46, 0x0c, 0xa0, 0x66
  opcode "0x08 f64 ", [9000.1_f64],              0x08, 0x40, 0xc1, 0x94, 0x0c, 0xcc, 0xcc, 0xcc, 0xcd
  opcode "0x09 str ", ["Hello, world!"],         0x09, 13.bytes, "Hello, world!".bytes
  opcode "0x0a list", [[true, false]],           0x02, 0, 0x02, 1, 0x0a, 0x00, 0x00, 0x00, 0x02
end

describe "SECTION: Type Queries (0x1_)" do
  opcode "0x10 null?", [nil,         true], 0x00, 0x10
  opcode "0x11 byte?", [0x0_u8,      true], 0x01, 0x0, 0x11
  opcode "0x12 bool?", [false,       true], 0x02, 0x0, 0x12
  opcode "0x13 i32? ", [0_i32,       true], 0x03, 0x0, 0x0, 0x0, 0x0, 0x13
  opcode "0x14 i64? ", [0_i64,       true], 0x04, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x14
  opcode "0x15 u32? ", [0_u32,       true], 0x05, 0x0, 0x0, 0x0, 0x0, 0x15
  opcode "0x16 u64? ", [0_u64,       true], 0x06, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x16
  opcode "0x17 f32? ", [0.0_f32,     true], 0x07, 0x0, 0x0, 0x0, 0x0, 0x17
  opcode "0x18 f64? ", [0.0_f64,     true], 0x08, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x18
  opcode "0x19 str? ", ["",          true], 0x09, 0x0, 0x0, 0x0, 0x0, 0x19
  opcode "0x1a list?", [[] of SWAny, true], 0x0a, 0x0, 0x0, 0x0, 0x0, 0x1a
end

describe "SECTION: Stack Operations (0x2_)" do
  opcode "0x20 drop", [] of SWAny,   0x00, 0x20
  opcode "0x21 dupe", [nil, nil],    0x00, 0x21
  opcode "0x22 swap", [true, false], 0x02, 0, 0x02, 1, 0x22
end

describe "SECTION: Arithmetic Operations (0x3_)" do
  opcode "0x30 add ", [5], 0x01, 2, 0x01, 3, 0x30
  opcode "0x31 sub ", [1], 0x01, 3, 0x01, 2, 0x31
  opcode "0x32 mul ", [6], 0x01, 2, 0x01, 3, 0x32
  opcode "0x33 div ", [2], 0x01, 4, 0x01, 2, 0x33
  opcode "0x34 mod ", [1], 0x01, 5, 0x01, 2, 0x34
  opcode "0x35 shl ", [0b10010000], 0x01, 0b00100100, 0x01, 2, 0x35
  opcode "0x36 shr ", [0b00001001], 0x01, 0b00100100, 0x01, 2, 0x36
  opcode "0x37 not ", [0b11011011], 0x01, 0b00100100, 0x37
  opcode "0x38 and ", [0b00100000], 0x01, 0b00100100, 0x01, 0b11111011, 0x38
  opcode "0x39 or  ", [0b10110100], 0x01, 0b00100100, 0x01, 0b10010000, 0x39
  opcode "0x3a xor ", [0b10110000], 0x01, 0b00100100, 0x01, 0b10010100, 0x3a
end

describe "SECTION: Comparison Operations" do
  opcode "0x40 eql?", [true], 0x01, 2, 0x01, 2, 0x40, 0x22, 0x20, 0x22, 0x20
  opcode "0x41 neq?", [true], 0x01, 2, 0x01, 1, 0x41, 0x22, 0x20, 0x22, 0x20
  opcode "0x42 grt?", [true], 0x01, 2, 0x01, 1, 0x42, 0x22, 0x20, 0x22, 0x20
  opcode "0x43 gte?", [true], 0x01, 2, 0x01, 2, 0x43, 0x22, 0x20, 0x22, 0x20
  opcode "0x44 lst?", [true], 0x01, 2, 0x01, 3, 0x44, 0x22, 0x20, 0x22, 0x20
  opcode "0x45 lse?", [true], 0x01, 2, 0x01, 2, 0x45, 0x22, 0x20, 0x22, 0x20
end

describe "SECTION: IO Operations (0x5_)" do
  opcode "0x50 getc", ['a'.ord],   0x50, stdin: "abc"
  opcode "0x51 getl", ["abc"],     0x51, stdin: "abc\ntest"
  opcode "0x52 putc", [] of SWAny, 0x01, 97, 0x52, stdout: "a"
  opcode "0x53 putl", [] of SWAny, 0x09, 14.bytes, "Hello, world!\n".bytes, 0x53, stdout: "Hello, world!\n"
end

# TODO: Variable Operations
# TODO: Control Flow
